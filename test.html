<script>
  // ...（省略）...

  async function playId(id){
    if(!id) { alert('YouTube ID を解析できませんでした'); return; }

    // 既存プレイヤー削除
    const container = document.getElementById('player') || document.body;
    let holder = document.getElementById('ry_yt_holder');
    if(!holder){
      holder = document.createElement('div');
      holder.id = 'ry_yt_holder';
      holder.style.width = '100%';
      holder.style.height = '100%';
      container.insertBefore(holder, container.firstChild);
    } else {
      holder.innerHTML = '';
    }

    await ensureYouTubeApiLoaded();
    // 既存インスタンスがあれば使い回し
    if(window.__RY_TEMP_PLAYER && window.__RY_TEMP_PLAYER.loadVideoById){
      try{ window.__RY_TEMP_PLAYER.loadVideoById(id); return; }catch(e){}
    }
    // 新規プレイヤー生成（ループなし）
    window.__RY_TEMP_PLAYER = new YT.Player('ry_yt_holder', {
      width: '100%',
      height: '100%',
      videoId: id,
      playerVars: {
        controls: 1,
        rel: 0,
        modestbranding: 1,
        enablejsapi: 1,
        origin: location.origin
      }
    });
  }

  // ...（省略）...
</script>
