<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>YouTube iframe プレイヤ（キーボード + オーバーレイ）</title>
<style>
  body{margin:0;font-family:system-ui;background:#071022;color:#fff;display:flex;align-items:center;justify-content:center;height:100vh}
  .wrap{width:900px;max-width:96vw;position:relative}
  #player-wrap{position:relative;padding-top:56.25%;background:#000;border-radius:8px;overflow:hidden}
  #yt-player{position:absolute;left:0;top:0;width:100%;height:100%}
  /* overlay */
  #end-overlay{position:absolute;left:0;right:0;top:0;bottom:0;display:flex;align-items:flex-end;justify-content:center;padding:18px;pointer-events:none;opacity:0;transition:opacity .2s}
  #end-overlay.show{opacity:1;pointer-events:auto}
  .cards{display:flex;gap:12px;background:rgba(0,0,0,0.75);padding:12px;border-radius:8px}
  .card{width:220px;color:#fff;text-decoration:none}
  .card .thumb{height:112px;background-size:cover;border-radius:6px}
  .controls-hint{margin-top:12px;color:#9fb0bf;font-size:13px;text-align:center}
</style>
</head>
<body>
  <div class="wrap">
    <div id="player-wrap">
      <div id="yt-player"></div>
      <div id="end-overlay" aria-hidden="true"><div class="cards" id="cards"></div></div>
    </div>
    <div class="controls-hint">Space: 再生/停止 · ←/→: 5s シーク · ↑/↓: 音量 · M: ミュート · F: 全画面 · O: オーバーレイ</div>
  </div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
/* 設定: 再生したい YouTube ID を置き換える */
const VIDEO_ID = '6NeaaUPXZMg';

let player;
function onYouTubeIframeAPIReady(){
  player = new YT.Player('yt-player', {
    height: '100%',
    width: '100%',
    videoId: VIDEO_ID,
    playerVars: {
      controls: 1,
      rel: 1,
      modestbranding: 0,
      enablejsapi: 1,
      origin: location.origin
    },
    events: {
      onReady: onReady,
      onStateChange: onPlayerStateChange
    }
  });
}

function onReady(){ /* optional */ }

function onPlayerStateChange(e){
  if(e.data === YT.PlayerState.ENDED) showEndOverlay();
  else hideEndOverlay();
}

/* Overlay (終了画面風) */
const overlay = document.getElementById('end-overlay');
const cards = document.getElementById('cards');
function showEndOverlay(){
  cards.innerHTML = '';
  const list = [
    {id: VIDEO_ID, title: 'この動画をもう一度'},
    {id: 'dQw4w9WgXcQ', title: 'おすすめサンプル'},
    {id: '6NeaaUPXZMg', title: '同シリーズ'}
  ];
  list.forEach(s=>{
    const a = document.createElement('a');
    a.className = 'card';
    a.href = `https://www.youtube.com/watch?v=${s.id}`;
    a.target = '_blank';
    a.rel = 'noopener noreferrer';
    a.innerHTML = `<div class="thumb" style="background-image:url('https://i.ytimg.com/vi/${s.id}/hqdefault.jpg')"></div><div style="padding:8px;font-weight:700">${s.title}</div>`;
    cards.appendChild(a);
  });
  overlay.classList.add('show');
  overlay.setAttribute('aria-hidden','false');
}
function hideEndOverlay(){ overlay.classList.remove('show'); overlay.setAttribute('aria-hidden','true'); }

/* キーボード操作 */
document.addEventListener('keydown', async (e)=>{
  const active = document.activeElement;
  if(active && (active.tagName==='INPUT' || active.tagName==='TEXTAREA' || active.isContentEditable)) return;
  if(!player || typeof player.getPlayerState !== 'function') return;
  const key = e.key;
  if(key === ' '){
    e.preventDefault();
    const state = player.getPlayerState();
    if(state === YT.PlayerState.PLAYING) player.pauseVideo();
    else player.playVideo();
    return;
  }
  if(key === 'ArrowLeft' || key === 'ArrowRight'){
    e.preventDefault();
    try {
      const cur = player.getCurrentTime();
      const dur = player.getDuration() || 0;
      const delta = key === 'ArrowLeft' ? -5 : 5;
      let target = Math.min(Math.max(0, cur + delta), dur);
      player.seekTo(target, true);
    } catch(err){ console.warn(err); }
    return;
  }
  if(key === 'ArrowUp' || key === 'ArrowDown'){
    e.preventDefault();
    try {
      let vol = player.getVolume();
      vol = key === 'ArrowUp' ? Math.min(100, vol + 10) : Math.max(0, vol - 10);
      player.setVolume(vol);
      if(vol === 0) player.mute(); else player.unMute();
    } catch(err){ console.warn(err); }
    return;
  }
  if(key.toLowerCase() === 'm'){
    e.preventDefault();
    try{ if(player.isMuted()) player.unMute(); else player.mute(); }catch(e){}
    return;
  }
  if(key.toLowerCase() === 'f'){
    e.preventDefault();
    const el = document.querySelector('.wrap');
    try{ if(!document.fullscreenElement) await el.requestFullscreen(); else await document.exitFullscreen(); }catch(err){ console.warn(err); }
    return;
  }
  if(key.toLowerCase() === 'o'){
    e.preventDefault();
    if(overlay.classList.contains('show')) hideEndOverlay(); else showEndOverlay();
    return;
  }
});
</script>
</body>
</html>
